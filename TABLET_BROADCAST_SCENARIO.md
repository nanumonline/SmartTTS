# 📱 태블릿 PC 방송 송출 시나리오

## 🎯 사용자 시나리오

### 현재 상황

**목표:**
- 관리자가 웹 서비스에서 스케줄이나 음원 송출 설정
- 태블릿 PC가 방송 장비에 RJ-45 잭으로 연결됨
- 설정된 시간에 태블릿 PC로 음원이 자동 송출되어 방송 장비로 전송됨

**시나리오:**
1. 태블릿 PC가 방송 장비에 연결되어 대기
2. 관리자가 다른 PC에서 웹 서비스 로그인
3. 스케줄 관리에서 음원 송출 시간 및 채널 설정
4. 설정된 시간에 자동으로 태블릿 PC로 음원 전송
5. 태블릿 PC에서 오디오 재생 → 방송 장비로 출력

---

## ✅ 현재 시스템 상태

### 구현된 부분

1. **웹 서비스 (관리자)**
   - ✅ 스케줄 생성 및 관리
   - ✅ 채널 설정 (엔드포인트 URL 설정)
   - ✅ 음원 생성 및 저장

2. **자동 실행 시스템**
   - ✅ Supabase Edge Function (`execute-schedules`)
   - ✅ pg_cron으로 1분마다 자동 실행
   - ✅ 스케줄 확인 및 오디오 전송

3. **엔드포인트 서버**
   - ✅ Hostinger 서버에 PHP 엔드포인트 설정
   - ✅ POST 요청으로 오디오 데이터 수신
   - ✅ 오디오 파일 저장 및 로그 기록

### 부족한 부분

1. **태블릿 PC 연결**
   - ❌ 태블릿 PC가 오디오를 받을 수 있는 앱/웹페이지 필요
   - ❌ 실시간 오디오 재생 시스템 필요
   - ❌ 방송 장비로 출력하는 로직 필요

---

## 🚀 구현 방안

### 방법 1: HTTP 폴링 방식 (간단, 권장)

태블릿 PC에서 주기적으로 서버에 요청하여 새로운 오디오를 확인하고 재생

#### 작동 방식:

1. **태블릿 PC 앱/웹페이지**
   - 주기적으로 (예: 10초마다) 서버에 요청
   - 새로운 오디오 파일이 있으면 다운로드 및 재생

2. **서버 엔드포인트 수정**
   - 오디오를 저장한 후, 재생 대기 목록에 추가
   - 태블릿 PC에서 요청하면 재생할 오디오 반환

3. **재생 완료 후**
   - 태블릿 PC가 재생 완료 신호 전송
   - 서버에서 재생 완료 처리

#### 장점:
- ✅ 구현 간단
- ✅ 기존 HTTP 엔드포인트 활용 가능
- ✅ 방화벽 문제 없음

#### 단점:
- ⚠️ 폴링 간격에 따른 지연 가능

---

### 방법 2: WebSocket 방식 (실시간)

태블릿 PC와 서버 간 실시간 양방향 통신

#### 작동 방식:

1. **태블릿 PC 앱/웹페이지**
   - 서버와 WebSocket 연결 유지
   - 서버에서 오디오 전송 알림 수신

2. **서버**
   - 오디오 저장 후 WebSocket으로 태블릿 PC에 알림
   - 오디오 데이터 전송

3. **태블릿 PC**
   - 오디오 수신 후 즉시 재생

#### 장점:
- ✅ 실시간 통신
- ✅ 즉시 재생 가능

#### 단점:
- ⚠️ WebSocket 서버 구현 필요
- ⚠️ 연결 관리 복잡

---

### 방법 3: 푸시 알림 방식 (앱)

태블릿 PC 앱이 푸시 알림을 받아서 오디오 다운로드 및 재생

#### 작동 방식:

1. **태블릿 PC 앱**
   - 푸시 알림 서비스 등록 (FCM 등)
   - 알림 수신 시 서버에서 오디오 다운로드 및 재생

2. **서버**
   - 오디오 저장 후 푸시 알림 발송
   - 태블릿 PC가 오디오 다운로드

#### 장점:
- ✅ 즉시 알림 가능
- ✅ 배터리 효율적 (폴링 불필요)

#### 단점:
- ⚠️ 앱 개발 필요
- ⚠️ 푸시 서비스 설정 필요

---

## 📋 추천 구현 방법

### 단계별 구현 (HTTP 폴링 방식 권장)

#### 1단계: 태블릿 PC용 웹페이지/앱 생성

**기능:**
- 서버에서 재생 대기 오디오 확인
- 오디오 다운로드 및 재생
- 방송 장비로 출력 (오디오 재생)

**구현 위치:**
```
tts.nanum.online/player/
또는
태블릿 PC 앱
```

#### 2단계: 서버 엔드포인트 확장

**현재 엔드포인트:**
- POST `/api/broadcast/` - 오디오 수신 및 저장

**추가 필요:**
- GET `/api/broadcast/pending` - 재생 대기 오디오 목록
- GET `/api/broadcast/audio/{id}` - 오디오 파일 다운로드
- POST `/api/broadcast/played/{id}` - 재생 완료 신호

#### 3단계: 채널 설정 확장

**현재 채널 설정:**
- 채널 이름, 타입, 엔드포인트 URL

**추가 필요:**
- 태블릿 PC 식별자 (디바이스 ID)
- 채널별 태블릿 PC 연결 상태
- 태블릿 PC 연결 확인 API

---

## 🔧 구현 예시

### 예시 1: 태블릿 PC용 웹페이지

**파일 위치:**
```
public_html/tts/player/index.html
```

**기능:**
- 주기적으로 서버에 요청 (10초마다)
- 재생 대기 오디오 확인
- 오디오 재생
- 재생 완료 후 서버에 신호 전송

### 예시 2: 서버 API 확장

**파일 위치:**
```
public_html/tts/api/broadcast/pending.php
public_html/tts/api/broadcast/audio.php
public_html/tts/api/broadcast/played.php
```

**기능:**
- 재생 대기 오디오 목록 반환
- 오디오 파일 다운로드
- 재생 완료 처리

---

## 💡 구현 전 확인 사항

### 1. 태블릿 PC 환경

- **OS**: Android, iOS, Windows?
- **브라우저**: Chrome, Safari 등?
- **앱 사용 가능**: 네이티브 앱 개발 가능?
- **방송 장비 연결**: RJ-45 (네트워크) 또는 오디오 케이블?

### 2. 네트워크 환경

- **태블릿 PC IP**: 고정 IP 또는 동적 IP?
- **방화벽**: 방송 장비 네트워크에 방화벽이 있는지?
- **인터넷 연결**: 태블릿 PC가 인터넷에 연결되어 있는지?

### 3. 방송 장비

- **장비 타입**: 라디오 방송 장비, PA 시스템 등?
- **연결 방식**: RJ-45 (네트워크) 또는 오디오 케이블?
- **제어 방법**: 네트워크 제어 가능 또는 오디오만 입력?

---

## 📝 다음 단계

### 1. 태블릿 PC 환경 확인

- 태블릿 PC OS 및 브라우저 확인
- 방송 장비 연결 방식 확인
- 네트워크 환경 확인

### 2. 구현 방법 선택

- **간단한 방법**: HTTP 폴링 (웹페이지)
- **실시간 방법**: WebSocket (웹페이지 또는 앱)
- **모바일 앱**: 푸시 알림 (네이티브 앱)

### 3. 구현 시작

- 태블릿 PC용 플레이어 생성
- 서버 API 확장
- 테스트 및 확인

---

**태블릿 PC 환경과 방송 장비 연결 방식을 알려주시면 더 구체적인 구현 방법을 제안하겠습니다!** 🚀

